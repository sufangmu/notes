
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="苏方木的笔记">
      
      
      
        <meta name="author" content="苏方木">
      
      
        <link rel="canonical" href="https://github.com/sufangmu/notes/CICD/Ansible/ansible/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.1, mkdocs-material-7.1.9">
    
    
      
        <title>Ansible基础 - 苏方木的笔记</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.ca7ac06f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.f1a3b89f.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700%7CUbuntu+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Ubuntu";--md-code-font-family:"Ubuntu Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/default.min.css">
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ansible" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="苏方木的笔记" class="md-header__button md-logo" aria-label="苏方木的笔记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            苏方木的笔记
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Ansible基础
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      首页
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../linux/command-line/" class="md-tabs__link">
        Linux
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../databases/MySQL/%E5%AE%89%E8%A3%85/" class="md-tabs__link">
        数据库
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../web/%E5%8D%8F%E8%AE%AE/HTTP/" class="md-tabs__link">
        前端
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../programming/python/%E5%9F%BA%E7%A1%80/01-python%E7%AE%80%E4%BB%8B/" class="md-tabs__link">
        编程语言
      </a>
    </li>
  

  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../Virtualization/Docker/%E5%AE%89%E8%A3%85/" class="md-tabs__link">
        虚拟化
      </a>
    </li>
  

  

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../Git/Git/" class="md-tabs__link md-tabs__link--active">
        CI&CD
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../resource/docs/" class="md-tabs__link">
        资源
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../music/xiao/" class="md-tabs__link">
        音乐
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="苏方木的笔记" class="md-nav__button md-logo" aria-label="苏方木的笔记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    苏方木的笔记
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        首页
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Linux
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Linux" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/command-line/" class="md-nav__link">
        命令行
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/grep_sed_awk/" class="md-nav__link">
        文本处理
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/ShellScript/" class="md-nav__link">
        ShellScript
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/vim/" class="md-nav__link">
        VIM
      </a>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" type="checkbox" id="__nav_2_5" >
      
      <label class="md-nav__link" for="__nav_2_5">
        网络
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="网络" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          网络
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/network/TCP/" class="md-nav__link">
        TCP/IP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/network/iptables/" class="md-nav__link">
        Iptables
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/docs/" class="md-nav__link">
        文档
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        数据库
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="数据库" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          数据库
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      <label class="md-nav__link" for="__nav_3_1">
        mysql
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="mysql" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          mysql
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../databases/MySQL/%E5%AE%89%E8%A3%85/" class="md-nav__link">
        安装
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../databases/MySQL/%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/" class="md-nav__link">
        用户管理
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../databases/MySQL/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E8%BF%90%E7%AE%97%E7%AC%A6/" class="md-nav__link">
        数据类型和运算符
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../databases/MySQL/SQL/" class="md-nav__link">
        SQL
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../databases/MySQL/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0/" class="md-nav__link">
        存储过程和函数
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../databases/MySQL/%E7%B4%A2%E5%BC%95/" class="md-nav__link">
        索引
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../databases/MySQL/%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92/" class="md-nav__link">
        执行计划
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        前端
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="前端" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          前端
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/%E5%8D%8F%E8%AE%AE/HTTP/" class="md-nav__link">
        HTTP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/%E5%8D%8F%E8%AE%AE/RESTful/" class="md-nav__link">
        RESTful
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/%E8%AF%AD%E8%A8%80/html/" class="md-nav__link">
        HTML
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/%E8%AF%AD%E8%A8%80/CSS/" class="md-nav__link">
        CSS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/%E8%AF%AD%E8%A8%80/JavaScript/" class="md-nav__link">
        JavaScript
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/%E6%A1%86%E6%9E%B6/jQuery/" class="md-nav__link">
        jQuery
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        编程语言
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="编程语言" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          编程语言
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" type="checkbox" id="__nav_5_1" >
      
      <label class="md-nav__link" for="__nav_5_1">
        Python
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1_1" type="checkbox" id="__nav_5_1_1" >
      
      <label class="md-nav__link" for="__nav_5_1_1">
        基础
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="基础" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_1_1">
          <span class="md-nav__icon md-icon"></span>
          基础
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/%E5%9F%BA%E7%A1%80/01-python%E7%AE%80%E4%BB%8B/" class="md-nav__link">
        python简介
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/%E5%9F%BA%E7%A1%80/02-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="md-nav__link">
        基本数据类型
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/%E5%9F%BA%E7%A1%80/03-%E9%80%BB%E8%BE%91%E6%8E%A7%E5%88%B6/" class="md-nav__link">
        逻辑控制
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/%E5%9F%BA%E7%A1%80/04-%E5%87%BD%E6%95%B0/" class="md-nav__link">
        函数
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/%E5%9F%BA%E7%A1%80/05-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" class="md-nav__link">
        面向对象
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/%E5%9F%BA%E7%A1%80/06-%E5%8C%85%E5%92%8C%E6%A8%A1%E5%9D%97/" class="md-nav__link">
        包和模块
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/%E5%9F%BA%E7%A1%80/07-%E8%BF%AD%E4%BB%A3%E5%92%8C%E6%8E%A8%E5%AF%BC/" class="md-nav__link">
        迭代和推导
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/%E5%9F%BA%E7%A1%80/08-%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/" class="md-nav__link">
        文件处理
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/%E5%9F%BA%E7%A1%80/09-%E5%BC%82%E5%B8%B8%E4%B8%8E%E6%B5%8B%E8%AF%95/" class="md-nav__link">
        异常处理
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/%E5%9F%BA%E7%A1%80/01-%E5%86%85%E7%BD%AE%E6%A8%A1%E5%9D%97/" class="md-nav__link">
        内置模块
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/%E5%9F%BA%E7%A1%80/02-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        并行编程
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/%E5%9F%BA%E7%A1%80/03-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        网络编程
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/%E5%9F%BA%E7%A1%80/04-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        数据库编程
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1_2" type="checkbox" id="__nav_5_1_2" >
      
      <label class="md-nav__link" for="__nav_5_1_2">
        Django
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Django" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_1_2">
          <span class="md-nav__icon md-icon"></span>
          Django
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/Django/install/" class="md-nav__link">
        安装
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/Django/response/" class="md-nav__link">
        请求响应三板斧
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/Django/urls/" class="md-nav__link">
        路由层
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/Django/view/" class="md-nav__link">
        视图层
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/Django/template/" class="md-nav__link">
        模板层
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/Django/model/" class="md-nav__link">
        模型层
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/Django/middleware/" class="md-nav__link">
        中间件
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/Django/forms/" class="md-nav__link">
        表单
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/Django/auth/" class="md-nav__link">
        auth模块
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/Django/cookie%26session/" class="md-nav__link">
        cookie和session
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/Django/admin/" class="md-nav__link">
        admin
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1_3" type="checkbox" id="__nav_5_1_3" >
      
      <label class="md-nav__link" for="__nav_5_1_3">
        DjangoRESTframework
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="DjangoRESTframework" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_1_3">
          <span class="md-nav__icon md-icon"></span>
          DjangoRESTframework
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/DjangoRESTframework/install/" class="md-nav__link">
        安装
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/DjangoRESTframework/%E5%BA%8F%E5%88%97%E5%8C%96/" class="md-nav__link">
        序列化
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/DjangoRESTframework/%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94/" class="md-nav__link">
        请求和响应
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/DjangoRESTframework/%E8%A7%86%E5%9B%BE/" class="md-nav__link">
        视图
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/DjangoRESTframework/%E8%B7%AF%E7%94%B1/" class="md-nav__link">
        路由
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/DjangoRESTframework/%E8%AE%A4%E8%AF%81%E3%80%81%E6%9D%83%E9%99%90%E5%92%8C%E9%A2%91%E7%8E%87/" class="md-nav__link">
        认证、权限和频率
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/DjangoRESTframework/%E8%BF%87%E6%BB%A4%E3%80%81%E6%8E%92%E5%BA%8F%E3%80%81%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/" class="md-nav__link">
        过滤、排序、异常处理
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/DjangoRESTframework/%E8%87%AA%E5%AE%9A%E4%B9%89response/" class="md-nav__link">
        自定义response
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1_4" type="checkbox" id="__nav_5_1_4" >
      
      <label class="md-nav__link" for="__nav_5_1_4">
        Flask
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Flask" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_1_4">
          <span class="md-nav__icon md-icon"></span>
          Flask
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/Flask/install/" class="md-nav__link">
        简介与安装
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/Jinja2/" class="md-nav__link">
        Jinja2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/python/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/" class="md-nav__link">
        数据结构和算法
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        虚拟化
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="虚拟化" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          虚拟化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_1" type="checkbox" id="__nav_6_1" >
      
      <label class="md-nav__link" for="__nav_6_1">
        Docker
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Docker" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../Virtualization/Docker/%E5%AE%89%E8%A3%85/" class="md-nav__link">
        实现
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" checked>
      
      <label class="md-nav__link" for="__nav_7">
        CI&CD
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="CI&CD" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          CI&CD
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1" type="checkbox" id="__nav_7_1" >
      
      <label class="md-nav__link" for="__nav_7_1">
        版本控制
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="版本控制" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          版本控制
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Git/Git/" class="md-nav__link">
        Git
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2" type="checkbox" id="__nav_7_2" >
      
      <label class="md-nav__link" for="__nav_7_2">
        Jenkins
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Jenkins" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          Jenkins
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Jenkins/jenkins-pipeline-syntax/" class="md-nav__link">
        pipeline-syntax
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Jenkins/jenkinsfile/" class="md-nav__link">
        jenkinsfile
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3" type="checkbox" id="__nav_7_3" checked>
      
      <label class="md-nav__link" for="__nav_7_3">
        Ansible
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Ansible" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_3">
          <span class="md-nav__icon md-icon"></span>
          Ansible
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Ansible基础
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Ansible基础
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ansible" class="md-nav__link">
    一、Ansible简介
  </a>
  
    <nav class="md-nav" aria-label="一、Ansible简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1ansible" class="md-nav__link">
    1、Ansible架构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2ansible" class="md-nav__link">
    2、Ansible实现原理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3ansible" class="md-nav__link">
    3、Ansible特点
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4、主要用途
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5、安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    6、目录结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    7、与其他工具的对比
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8ansible" class="md-nav__link">
    8、Ansible的配置文件读取
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    二、基本用法
  </a>
  
    <nav class="md-nav" aria-label="二、基本用法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1ansible_1" class="md-nav__link">
    1、Ansible命令执行方式：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2ansible_1" class="md-nav__link">
    2、ansible系列命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-ansible-inventory" class="md-nav__link">
    3、 Ansible Inventory配置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    4. 变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-ad-hoc" class="md-nav__link">
    5. Ad-Hoc使用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playbook" class="md-nav__link">
    三、Playbook
  </a>
  
    <nav class="md-nav" aria-label="三、Playbook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 格式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-handler" class="md-nav__link">
    2. Handler：
  </a>
  
    <nav class="md-nav" aria-label="2. Handler：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1notify-handler" class="md-nav__link">
    1.notify 触发handler
  </a>
  
    <nav class="md-nav" aria-label="1.notify 触发handler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2handler-handler" class="md-nav__link">
    2.handler 调用 handler
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3. 变量
  </a>
  
    <nav class="md-nav" aria-label="3. 变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    1.命名规则
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2.变量的定义
  </a>
  
    <nav class="md-nav" aria-label="2.变量的定义">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1vars" class="md-nav__link">
    1.在vars代码块定义变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    2. 把变量定义到单独的文件中
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-inventory" class="md-nav__link">
    3. 在Inventory文件中定义变量（不建议）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_2" class="md-nav__link">
    4. 注册变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-facts" class="md-nav__link">
    5. facts信息
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_1" class="md-nav__link">
    6. 变量的优先级
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-ifthenwhen" class="md-nav__link">
    4. 流程控制 if/then/when
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#when" class="md-nav__link">
    when
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changed_whenfailed_when" class="md-nav__link">
    changed_when、failed_when
  </a>
  
    <nav class="md-nav" aria-label="changed_when、failed_when">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5_1" class="md-nav__link">
    5. 任务间流程控制
  </a>
  
    <nav class="md-nav" aria-label="5. 任务间流程控制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    1.任务暂停
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_2" class="md-nav__link">
    6. 交互式提示
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_1" class="md-nav__link">
    7. 标签
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-block" class="md-nav__link">
    8. block块
  </a>
  
    <nav class="md-nav" aria-label="8. block块">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    1.示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    2.错误处理
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-include" class="md-nav__link">
    9. Include
  </a>
  
    <nav class="md-nav" aria-label="9. Include">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_4" class="md-nav__link">
    1. 基本用法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    2. 动态加载
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_4" type="checkbox" id="__nav_7_4" >
      
      <label class="md-nav__link" for="__nav_7_4">
        Jenkins
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Jenkins" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_4">
          <span class="md-nav__icon md-icon"></span>
          Jenkins
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Jenkins/Jenkins%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        Jenkins基础
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      <label class="md-nav__link" for="__nav_8">
        资源
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="资源" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          资源
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../resource/docs/" class="md-nav__link">
        资源
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      <label class="md-nav__link" for="__nav_9">
        音乐
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="音乐" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          音乐
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../music/xiao/" class="md-nav__link">
        箫
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../music/zhudi/" class="md-nav__link">
        笛
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../music/guqin/" class="md-nav__link">
        古琴
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../music/pipa/" class="md-nav__link">
        琵琶
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../music/erhu/" class="md-nav__link">
        二胡
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Ansible基础</h1>
                
                <p>Ansible是主流的自动化运维工具之一，类似产品还有Chef、Puppet、SaltStack等。第一个版本是0.0.1,发布于2012年3月9日。</p>
<h2 id="ansible">一、Ansible简介<a class="headerlink" href="#ansible" title="Permanent link">&para;</a></h2>
<h3 id="1ansible">1、Ansible架构<a class="headerlink" href="#1ansible" title="Permanent link">&para;</a></h3>
<ol>
<li>引擎：Ansible</li>
<li>模块：</li>
<li>
<p>核心模块（core modules）:自带模块
   自定义模块（custom modules）</p>
</li>
<li>
<p>插件（plugins）:模块功能的补充，借助插件完成记录日志、邮件功能</p>
</li>
<li>剧本（playbooks）:任务配置文件，可以包含多个任务。</li>
<li>连接插件（connectior plugins）:通过连接插件连接到被管理主机，默认使用SSH。还支持Zeromq、local连接方式</li>
<li>主机清单（host inventory）:定义被管理节点</li>
</ol>
<h3 id="2ansible">2、Ansible实现原理<a class="headerlink" href="#2ansible" title="Permanent link">&para;</a></h3>
<p>Ansible执行命令时，通过其底层传输模块，将一个或多个文件，或者定义一个Play或Command命令传输到远程服务器的/tmp目录的临时文件，并在远程执行这些Play/Command，然后删除临时文件并返回命令的执行结果</p>
<p>Ansible的通信发展史：</p>
<ol>
<li>使用Paramiko</li>
<li>OpenSSH(1.3默认使用)</li>
<li>accelerate加速模式</li>
<li>Faster OpenSSH in Ansible 1.5+(pipelining加速方式)</li>
</ol>
<h3 id="3ansible">3、Ansible特点<a class="headerlink" href="#3ansible" title="Permanent link">&para;</a></h3>
<ol>
<li>语法简单：基于YAML</li>
<li>无客户端：不需要安装客户端，通过SSH连接被管理主机</li>
<li>Push退送</li>
<li>大量内置模块：“ansible-doc -l”可以查看已有的模块</li>
<li>等幂性（idempotent）：已经在被管理端执行过的剧本不会再执行</li>
</ol>
<h3 id="4">4、主要用途<a class="headerlink" href="#4" title="Permanent link">&para;</a></h3>
<ol>
<li>应用部署</li>
<li>配置管理</li>
<li>任务流编排</li>
</ol>
<h3 id="5">5、安装<a class="headerlink" href="#5" title="Permanent link">&para;</a></h3>
<p>在Ubuntu上安装</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>sudo apt update
sudo apt-get install software-properties-common
sudo apt-add-repository --yes  ppa:ansible/ansible:2.7.6
sudo apt update
sudo apt-get install ansible
</code></pre></div>
</td></tr></table>
<h3 id="6">6、目录结构<a class="headerlink" href="#6" title="Permanent link">&para;</a></h3>
<ol>
<li>配置目录：/etc/ansible，功能：Inventory主机信息配置，Ansible工具配置</li>
<li>执行目录：/usr/bin/，功能：ansible默认命令存放目录</li>
<li>lib库依赖目录:/usr/lib/python2.7/dist-packages/ansible/*</li>
<li>帮助文档目录：/usr/share/doc/ansible/*</li>
<li>man文档目录：/usr/share/man/man1/</li>
</ol>
<h3 id="7">7、与其他工具的对比<a class="headerlink" href="#7" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>工具</th>
<th>Ansible</th>
<th>Puppet</th>
<th>Chef</th>
<th>SaltStack</th>
</tr>
</thead>
<tbody>
<tr>
<td>语言</td>
<td>Python</td>
<td>Ruby</td>
<td>Ruby</td>
<td>Python</td>
</tr>
<tr>
<td>架构</td>
<td>无Client</td>
<td>C/S</td>
<td>C/S</td>
<td>C/S</td>
</tr>
</tbody>
</table>
<h3 id="8ansible">8、Ansible的配置文件读取<a class="headerlink" href="#8ansible" title="Permanent link">&para;</a></h3>
<ol>
<li>环境变量中的ANSIBLE_CONFIG</li>
<li>当前目录下的ansible.cfg</li>
<li>~/.ansible.cfg</li>
<li>/etc/ansible/ansible.cfg</li>
</ol>
<h2 id="_1">二、基本用法<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h3 id="1ansible_1">1、Ansible命令执行方式：<a class="headerlink" href="#1ansible_1" title="Permanent link">&para;</a></h3>
<ol>
<li>Ad-Doc   用于执行临时命令</li>
<li>Ansible-playbooks</li>
<li>Tower（图形化，商业版）</li>
</ol>
<p>使用前先认证：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>ubuntu@server:~$ ssh-copy-id ubuntu@172.16.10.101
/usr/bin/ssh-copy-id: ERROR: No identities found
ubuntu@server:~$ ssh-keygen 
Generating public/private rsa key pair.
Enter file <span class="k">in</span> which to save the key <span class="o">(</span>/home/ubuntu/.ssh/id_rsa<span class="o">)</span>: 
Created directory <span class="s1">&#39;/home/ubuntu/.ssh&#39;</span>.
Enter passphrase <span class="o">(</span>empty <span class="k">for</span> no passphrase<span class="o">)</span>: 
Enter same passphrase again: 
Your identification has been saved <span class="k">in</span> /home/ubuntu/.ssh/id_rsa.
Your public key has been saved <span class="k">in</span> /home/ubuntu/.ssh/id_rsa.pub.
The key fingerprint is:
c6:31:74:1b:03:56:63:00:24:1f:45:10:79:60:cf:e8 ubuntu@server
The key<span class="s1">&#39;s randomart image is:</span>
<span class="s1">+--[ RSA 2048]----+</span>
<span class="s1">|    ..OOB+B      |</span>
<span class="s1">|     +.B.o =     |</span>
<span class="s1">|      o.= .      |</span>
<span class="s1">|     . . o       |</span>
<span class="s1">|      E S        |</span>
<span class="s1">|       .         |</span>
<span class="s1">|                 |</span>
<span class="s1">|                 |</span>
<span class="s1">|                 |</span>
<span class="s1">+-----------------+</span>
<span class="s1">ubuntu@server:~$ ssh-copy-id ubuntu@172.16.10.101</span>
<span class="s1">The authenticity of host &#39;</span><span class="m">172</span>.16.10.101 <span class="o">(</span><span class="m">172</span>.16.10.101<span class="o">)</span><span class="s1">&#39; can&#39;</span>t be established.
ECDSA key fingerprint is cd:f2:2a:0b:33:25:ba:94:36:6b:43:f7:02:e4:1c:d2.
Are you sure you want to <span class="k">continue</span> connecting <span class="o">(</span>yes/no<span class="o">)</span>? yes
/usr/bin/ssh-copy-id: INFO: attempting to log <span class="k">in</span> with the new key<span class="o">(</span>s<span class="o">)</span>, to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: <span class="m">1</span> key<span class="o">(</span>s<span class="o">)</span> remain to be installed -- <span class="k">if</span> you are prompted now it is to install the new keys
ubuntu@172.16.10.101<span class="s1">&#39;s password: </span>

<span class="s1">Number of key(s) added: 1</span>

<span class="s1">Now try logging into the machine, with:   &quot;ssh &#39;</span>ubuntu@172.16.10.101<span class="err">&#39;</span><span class="s2">&quot;</span>
<span class="s2">and check to make sure that only the key(s) you wanted were added.</span>
</code></pre></div>
</td></tr></table>
<h3 id="2ansible_1">2、ansible系列命令<a class="headerlink" href="#2ansible_1" title="Permanent link">&para;</a></h3>
<ol>
<li>ansible</li>
</ol>
<p>使用场景：临时一次性操作、二次开发接口调用</p>
<ol>
<li>ansible-galaxy</li>
</ol>
<p>使用场景：从 https://galaxy.ansible.com 下载Roles</p>
<ol>
<li>ansible-pull </li>
</ol>
<p>使用场景：需要配置的机器数量巨大</p>
<ol>
<li>ansible-doc</li>
</ol>
<p>使用场景：查看ansible模块的说明 </p>
<p>查看支持的模块：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>ubuntu@server:~$ ansible-doc -l <span class="p">|</span> wc -l
<span class="m">2080</span>
</code></pre></div>
</td></tr></table>
<ol>
<li>ansible-playbook   </li>
</ol>
<p>使用场景：读取预先编写的playbook文件实现批量管理</p>
<ol>
<li>ansible-vault </li>
</ol>
<p>使用场景：配置文件加密</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>  <span class="c1"># 加密yml文件</span>
  ansible-vault encrypt example.yml
</code></pre></div>
</td></tr></table>
<ol>
<li>ansible-console</li>
</ol>
<p>使用场景：交互式使用ansible命令</p>
<h3 id="3-ansible-inventory">3、 Ansible Inventory配置<a class="headerlink" href="#3-ansible-inventory" title="Permanent link">&para;</a></h3>
<p>Inventory是Ansible配置主机信息的配置文件。默认存放在/etc/ansible/hosts,使用时可以使用-i指定文件</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># 1. 直接为IP地址</span>
<span class="m">192</span>.168.1.100
<span class="c1"># 2. 主机名方式</span>
mysql.company.com
<span class="c1"># 3. ssh端口不是22的主机定义</span>
mysql.company.com:2222
<span class="c1"># 4. 有规律的主机</span>
<span class="m">192</span>.168.1.<span class="o">[</span><span class="m">101</span>:103<span class="o">]</span> <span class="c1"># 表示101 102 103</span>
mysql<span class="o">[</span>abc<span class="o">]</span>.company.com  <span class="c1"># mysqla mysqlb mysqlc</span>
<span class="c1"># 5. 定义组</span>
<span class="o">[</span>web<span class="o">]</span>
web1.company.com
web2.company.com
web3.company.com
<span class="c1"># 6. 组嵌套</span>
<span class="o">[</span>nginx<span class="o">]</span>
node1.company.com
node2.company.com
<span class="o">[</span>tomcat<span class="o">]</span>
node4.company.com
node5.company.com
<span class="o">[</span>web:children<span class="o">]</span>
nginx
tomcat
</code></pre></div>
</td></tr></table>
<h3 id="4_1">4. 变量<a class="headerlink" href="#4_1" title="Permanent link">&para;</a></h3>
<p>变量检索顺序</p>
<ol>
<li>Inventory配置文件</li>
<li>Playbook中var定义的区域</li>
<li>Roles中vars目录下的文件</li>
<li>Roles同级目录group_vars和hosts_vars目录下的文件</li>
</ol>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># 1. 主机变量</span>
<span class="o">[</span>web<span class="o">]</span>
host1 <span class="nv">http_port</span><span class="o">=</span><span class="m">80</span>

<span class="c1"># 2. 组变量</span>
<span class="o">[</span>web:vars<span class="o">]</span>
<span class="nv">ntp_server</span><span class="o">=</span>ntp.atlanta.example.com
</code></pre></div>
</td></tr></table>
<h3 id="5-ad-hoc">5. Ad-Hoc使用<a class="headerlink" href="#5-ad-hoc" title="Permanent link">&para;</a></h3>
<p>基本模块使用：</p>
<p>执行sudo</p>
<p>ansible sw3 -m command  -b  -K -a "docker images"
ansible all -m command -i hosts -a "free -h"</p>
<p>使用场景</p>
<ol>
<li>对服务器进行健康检查</li>
<li>其中一个或一组主机进行更改</li>
</ol>
<h2 id="playbook">三、Playbook<a class="headerlink" href="#playbook" title="Permanent link">&para;</a></h2>
<p>ansible的任务配置文件称为playbook(剧本)，每一个剧本都包含一系列的play。</p>
<h3 id="1">1. 格式<a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<p>ansible采用YAML语法编写，有两种格式：</p>
<ol>
<li>多行缩进(建议使用)</li>
</ol>
<p>官方示例：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nn">---</span>                     <span class="c1"># 需要以---开始，且要顶行首写</span>
<span class="c1"># 可以在这里简要说明playbook的功能(可选)</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>     <span class="c1"># 选择在哪些主机执行下面的play</span>
  <span class="nt">vars</span><span class="p">:</span>                 <span class="c1"># 定义的变量</span>
    <span class="nt">http_port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
    <span class="nt">max_clients</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200</span>
  <span class="nt">remote_user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
  <span class="nt">tasks</span><span class="p">:</span>                <span class="c1"># 指定一系列将要运行的任务</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ensure apache is at the latest version</span>
    <span class="nt">yum</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">httpd</span>
      <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">latest</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">write the apache config file</span>
    <span class="nt">template</span><span class="p">:</span>
      <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/srv/httpd.j2</span>
      <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/httpd.conf</span>
    <span class="nt">notify</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">restart apache</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ensure apache is running</span>
    <span class="nt">service</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">httpd</span>
      <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
  <span class="nt">handlers</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart apache</span>
      <span class="nt">service</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">httpd</span>
        <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restarted</span>
</code></pre></div>
</td></tr></table>
<ol>
<li>单行缩写</li>
</ol>
<h3 id="2-handler">2. Handler：<a class="headerlink" href="#2-handler" title="Permanent link">&para;</a></h3>
<h4 id="1notify-handler">1.notify 触发handler<a class="headerlink" href="#1notify-handler" title="Permanent link">&para;</a></h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">开启apache rewrite</span>
      <span class="nt">apache2_module</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rewrite</span>
        <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
  <span class="nt">handlers</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart apache</span>
      <span class="nt">service</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">httpd</span>
        <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restarted</span>
</code></pre></div>
</td></tr></table>
<h5 id="2handler-handler">2.handler 调用 handler<a class="headerlink" href="#2handler-handler" title="Permanent link">&para;</a></h5>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>  <span class="nt">handlers</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart apache</span>
      <span class="nt">service</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">httpd</span>
        <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restarted</span>
      <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart memcached</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart memcached</span>
      <span class="nt">service</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">memcached</span>
        <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restarted</span>
</code></pre></div>
</td></tr></table>
<p>注意： </p>
<ol>
<li>handler只有在其所在的任务被执行时，才会被运行</li>
<li>handler只会在play的末尾运行一次</li>
</ol>
<h3 id="3">3. 变量<a class="headerlink" href="#3" title="Permanent link">&para;</a></h3>
<h4 id="1_1">1.命名规则<a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h4>
<ol>
<li>以英文大小写字母开头</li>
<li>中间可以包含下划线(_)和数字</li>
</ol>
<h4 id="2">2.变量的定义<a class="headerlink" href="#2" title="Permanent link">&para;</a></h4>
<h5 id="1vars">1.在vars代码块定义变量<a class="headerlink" href="#1vars" title="Permanent link">&para;</a></h5>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">foo</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">debug</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">msg=&quot;var foo is set to {{ foo }}&quot;</span>
</code></pre></div>
</td></tr></table>
<h5 id="2_1">2. 把变量定义到单独的文件中<a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h5>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ cat vars.yml
---
foo: bar
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test</span>
  <span class="nt">vars_files</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">vars.yml</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">debug</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">msg=&quot;var foo is set to {{ foo }}&quot;</span>
</code></pre></div>
</td></tr></table>
<h5 id="3-inventory">3. 在Inventory文件中定义变量（不建议）<a class="headerlink" href="#3-inventory" title="Permanent link">&para;</a></h5>
<ol>
<li>为某台主机指定变量</li>
</ol>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">app1.example.com proxy_state=present</span>
</code></pre></div>
</td></tr></table>
<ol>
<li>为主机组定义变量</li>
</ol>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p p-Indicator">[</span><span class="nv">web</span><span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">node1</span>
<span class="l l-Scalar l-Scalar-Plain">node2</span>
<span class="l l-Scalar l-Scalar-Plain">[web:vars]</span>
<span class="l l-Scalar l-Scalar-Plain">http_port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div>
</td></tr></table>
<p>在执行ansible命令时，ansible默认会从/etc/ansible/host_vars和/etc/ansible/group_vars两个目录下读取变量定义，可以在
这两个目录中创建与hosts文件中主机名或组名同名的文件来定义变量，例如：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ cat /etc/ansible/group_vars/web
---
http_port: <span class="m">80</span>
</code></pre></div>
</td></tr></table>
<h4 id="4_2">4. 注册变量<a class="headerlink" href="#4_2" title="Permanent link">&para;</a></h4>
<p>将操作的结果，包括标准输出和标准错误输出保存到变量中，这个过程中用来保存操作结果的变量就叫<strong>注册变量</strong>。
在playbook中使用register来声明一个变量为注册变量。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">shell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my_command_here</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my_command_result</span>
</code></pre></div>
</td></tr></table>
<p>使用stdout方法来读取标准输出内容：my_command_result.stdout
使用stderr方法来读取错误输出内容：my_command_result.stderr</p>
<h4 id="5-facts">5. facts信息<a class="headerlink" href="#5-facts" title="Permanent link">&para;</a></h4>
<p>在运行任何一个playbook之前，ansible默认会先抓取playbook中所指定的所有主机的系统信息，这些信息称为facts。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>ubuntu@server:~/test$ ansible-playbook test.yml

PLAY <span class="o">[</span>web<span class="o">]</span> *************************************************************************************************************************************************************************************************************************

TASK <span class="o">[</span>Gathering Facts<span class="o">]</span> *************************************************************************************************************************************************************************************************************
ok: <span class="o">[</span><span class="m">172</span>.16.10.100<span class="o">]</span>

TASK <span class="o">[</span>debug<span class="o">]</span> ***********************************************************************************************************************************************************************************************************************
ok: <span class="o">[</span><span class="m">172</span>.16.10.100<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot;var http_port is set to 80&quot;</span>
<span class="o">}</span>

PLAY RECAP *************************************************************************************************************************************************************************************************************************
<span class="m">172</span>.16.10.100              : <span class="nv">ok</span><span class="o">=</span><span class="m">2</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">0</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
</code></pre></div>
</td></tr></table>
<p>facts信息的获取</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ ansible web -m setup
<span class="m">172</span>.16.10.100 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;ansible_facts&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;ansible_all_ipv4_addresses&quot;</span>: <span class="o">[</span>
            <span class="s2">&quot;172.16.10.100&quot;</span>,
            <span class="s2">&quot;10.0.3.15&quot;</span>
        <span class="o">]</span>,
        <span class="s2">&quot;ansible_all_ipv6_addresses&quot;</span>: <span class="o">[</span>
            <span class="s2">&quot;fe80::a00:27ff:fe15:7966&quot;</span>,
            <span class="s2">&quot;fe80::a00:27ff:fef4:8f74&quot;</span>
        <span class="o">]</span>,
</code></pre></div>
</td></tr></table>
<p>常用的facts变量：ansible_os_family,ansible_hostname,ansible_memtotal_mb。</p>
<p>如果需要在执行playbook之前跳过收集facts信息这一不可以在playbook中设置gather_facts：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web</span>
  <span class="nt">gather_facts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
</code></pre></div>
</td></tr></table>
<p><strong>本地facts变量</strong></p>
<p>在远程主机本地定义facts变量</p>
<p>需要把定义的变量写进一个以.fact结尾的文件中（放在/etc/ansible/facts.d/），这个文件可以是json或ini文件，或者是可以返回json代码的可执行文件</p>
<h4 id="6_1">6. 变量的优先级<a class="headerlink" href="#6_1" title="Permanent link">&para;</a></h4>
<p>由高到低排序</p>
<ol>
<li>在命令行中定义的变量(即用-e定义的变量)</li>
<li>在Inventory中定义的连接变量，如ansible_ssh_user</li>
<li>大多数其他变量(play中的变量，included中的变量，role中的变量)</li>
<li>在Inventory中定义的变量</li>
<li>由系统通gather_facts方法发现的变量</li>
<li>role默认变量</li>
</ol>
<h3 id="4-ifthenwhen">4. 流程控制 if/then/when<a class="headerlink" href="#4-ifthenwhen" title="Permanent link">&para;</a></h3>
<h2 id="when">when<a class="headerlink" href="#when" title="Permanent link">&para;</a></h2>
<p>在特定的条件下执行任务</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">测试php是否安装</span>
      <span class="nt">shell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">php --version</span>
      <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">php_version</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">如果安装就执行下面的操作</span>
      <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;php</span><span class="nv"> </span><span class="s">安装了&quot;</span>
      <span class="nt">when</span><span class="p">:</span> <span class="s">&quot;&#39;7.0&#39;</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">php_version.stdout&quot;</span>
</code></pre></div>
</td></tr></table>
<h2 id="changed_whenfailed_when">changed_when、failed_when<a class="headerlink" href="#changed_whenfailed_when" title="Permanent link">&para;</a></h2>
<p>根据任务运行返回结果判断任务的运行结果是否真的符合我们的预期</p>
<h3 id="5_1">5. 任务间流程控制<a class="headerlink" href="#5_1" title="Permanent link">&para;</a></h3>
<h4 id="1_2">1.任务暂停<a class="headerlink" href="#1_2" title="Permanent link">&para;</a></h4>
<p>一些服务的运行需要等待一些状态的恢复，比如一台主机或应用刚重启，需要等待它上面的端口开启，此时
就不得不将正在运行的任务暂停，直到状态满足我们的需求</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">等待web重启</span>
      <span class="nt">local_action</span><span class="p">:</span>
        <span class="nt">module</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wait_for</span>
        <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
        <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
        <span class="nt">delay</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
        <span class="nt">timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
        <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">重启后继续</span>
      <span class="nt">debug</span><span class="p">:</span>
         <span class="nt">msg</span><span class="p">:</span>  <span class="s">&quot;重启后执行后续操作&quot;</span>
</code></pre></div>
</td></tr></table>
<h3 id="6_2">6. 交互式提示<a class="headerlink" href="#6_2" title="Permanent link">&para;</a></h3>
<p>vars_prompt模块会在所有play执行前先执行，其优先级高于Gathering Facts。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">web</span>
  <span class="nt">vars_prompt</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">username</span>
      <span class="nt">prompt</span><span class="p">:</span> <span class="s">&quot;username&quot;</span>
      <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;root&quot;</span>   <span class="c1"># 设置默认值</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">password</span>
      <span class="nt">prompt</span><span class="p">:</span> <span class="s">&quot;password&quot;</span>
      <span class="nt">private</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>     <span class="c1"># 输入密码不可见</span>
      <span class="nt">confirm</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>     <span class="c1"># 要求输入两次</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">输出密码</span>
      <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">username</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">password</span><span class="nv"> </span><span class="s">}}&quot;</span>
</code></pre></div>
</td></tr></table>
<h3 id="7_1">7. 标签<a class="headerlink" href="#7_1" title="Permanent link">&para;</a></h3>
<p>标签功能可以给角色、文件、单独的任务打上标签，然后利用标签来指定要运行playbook中的个别任务或不执行指定的任务。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rabbitmq</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rabbitmq</span>
  <span class="nt">roles</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rabbitmq</span>
</code></pre></div>
</td></tr></table>
<p>执行带指定标签的任务</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>ansible-playbook --tags <span class="s2">&quot;rabbitmq&quot;</span> test.yml
</code></pre></div>
</td></tr></table>
<p>跳过带指定标签的任务</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>ansible-playbook --skip-tags <span class="s2">&quot;rabbitmq&quot;</span> test.yml
</code></pre></div>
</td></tr></table>
<p>可以加多个标签</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">tags</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">one</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">two</span>

<span class="c1"># or</span>

<span class="nt">tags</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;one&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;two&#39;</span><span class="p p-Indicator">]</span>
</code></pre></div>
</td></tr></table>
<h3 id="8-block">8. block块<a class="headerlink" href="#8-block" title="Permanent link">&para;</a></h3>
<p>2.0以后的版本引入，块功能可以将任务进行分组，并且可以在块级别上应用任务变量。块还可以块内部的任务异常</p>
<h4 id="1_3">1.示例<a class="headerlink" href="#1_3" title="Permanent link">&para;</a></h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code> <span class="nt">tasks</span><span class="p">:</span>
   <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install Apache</span>
     <span class="nt">block</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="nt">yum</span><span class="p">:</span>
           <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
           <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">installed</span>
         <span class="nt">with_items</span><span class="p">:</span>
           <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">httpd</span>
           <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">memcached</span>
       <span class="p p-Indicator">-</span> <span class="nt">template</span><span class="p">:</span>
           <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">templates/src.j2</span>
           <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/foo.conf</span>
       <span class="p p-Indicator">-</span> <span class="nt">service</span><span class="p">:</span>
           <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>
           <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
           <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
     <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible_facts[&#39;distribution&#39;] == &#39;CentOS&#39;</span>
     <span class="nt">become</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
     <span class="nt">become_user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
</code></pre></div>
</td></tr></table>
<h4 id="2_2">2.错误处理<a class="headerlink" href="#2_2" title="Permanent link">&para;</a></h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Attempt and graceful roll back demo</span>
  <span class="nt">block</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="s">&#39;I</span><span class="nv"> </span><span class="s">execute</span><span class="nv"> </span><span class="s">normally&#39;</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">i force a failure</span>
      <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/bin/false</span>
    <span class="p p-Indicator">-</span> <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="s">&#39;I</span><span class="nv"> </span><span class="s">never</span><span class="nv"> </span><span class="s">execute,</span><span class="nv"> </span><span class="s">due</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">above</span><span class="nv"> </span><span class="s">task</span><span class="nv"> </span><span class="s">failing,</span><span class="nv"> </span><span class="s">:-(&#39;</span>
  <span class="nt">rescue</span><span class="p">:</span>  <span class="c1"># 出错时执行</span>
    <span class="p p-Indicator">-</span> <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="s">&#39;I</span><span class="nv"> </span><span class="s">caught</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">error&#39;</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">i force a failure in middle of recovery! &gt;:-)</span>
      <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/bin/false</span>
    <span class="p p-Indicator">-</span> <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="s">&#39;I</span><span class="nv"> </span><span class="s">also</span><span class="nv"> </span><span class="s">never</span><span class="nv"> </span><span class="s">execute</span><span class="nv"> </span><span class="s">:-(&#39;</span>
  <span class="nt">always</span><span class="p">:</span> <span class="c1"># 无论结果如何都执行</span>
    <span class="p p-Indicator">-</span> <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;This</span><span class="nv"> </span><span class="s">always</span><span class="nv"> </span><span class="s">executes&quot;</span>
</code></pre></div>
</td></tr></table>
<h3 id="9-include">9. Include<a class="headerlink" href="#9-include" title="Permanent link">&para;</a></h3>
<h4 id="1_4">1. 基本用法<a class="headerlink" href="#1_4" title="Permanent link">&para;</a></h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">tasks</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">include</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">other.yml</span>
</code></pre></div>
</td></tr></table>
<h4 id="2_3">2. 动态加载<a class="headerlink" href="#2_3" title="Permanent link">&para;</a></h4>
<p>在满足一定条件时加载Include </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">include</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test.yml</span>
  <span class="nt">when</span><span class="p">:</span> 
</code></pre></div>
</td></tr></table>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" title="Back to top" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../Jenkins/jenkinsfile/" class="md-footer__link md-footer__link--prev" aria-label="Previous: jenkinsfile" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              jenkinsfile
            </div>
          </div>
        </a>
      
      
        
        <a href="../../Jenkins/Jenkins%E5%9F%BA%E7%A1%80/" class="md-footer__link md-footer__link--next" aria-label="Next: Jenkins基础" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Jenkins基础
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
      <a href="mailto:sufangmu8377@163.com" target="_blank" rel="noopener" title="" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M476 3.2 12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://github.com/sufangmu" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["toc.integrate", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "search.suggest", "search.highlight", "header.autohide"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.477d984a.min.js", "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.82b56eb2.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>
      
        <script src="../../../javascripts/config.js"></script>
      
    
  </body>
</html>